{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Título Predeterminado{% endblock %}</title>

    <!-- Agrega el script de Folium -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet/dist/leaflet.css"
        integrity="sha512-cUkEofb6z6O5/Dw7AnQgY44/LWGBjGgB20GJ4jb6U2qJX0MWBp9+e6fXbt8+B/T6GjzVUxfubAmYuW3hAXzgFA=="
        crossorigin=""
    />
    <script
        src="https://unpkg.com/leaflet/dist/leaflet.js"
        integrity="sha512-+TkL6Q7P6Vu+7FOe1j2zomkN8l+L8hBYRv6SoLw/QvR8hK5QwNsm9iuqBXPHxxfo0VHL8jbq7PBhrG8bB1IZDfA=="
        crossorigin=""
    ></script>
    <style>

    </style>
</head>
<body>
    {% include 'mapap/navega.html' %}
    {% block content %}
    {% endblock %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function cargarMapa(vista, latitud, longitud) {
            fetch('/' + vista + '/')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('content').innerHTML = data;
        
                    // Establecer las coordenadas iniciales después de cargar el mapa
                    var initialCoords = [latitud, longitud];
                    var map = folium.Map('map0').setView(initialCoords, 2);
        
                    // Agregar capa de mosaico (usando tiles de CartoDB Positron)
                    folium.TileLayer(
                        'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
                        {
                            attribution: '© OpenStreetMap contributors, CartoDB'
                        }
                    ).addTo(map);
        
                    // Iterar sobre las filas y manejar errores en la conversión de geometrías
                    // Aquí asumo que los datos están disponibles en algún lugar en la página HTML,
                    // puedes ajustar según tus necesidades.
                    var geoJsonData = /* Obtener tus datos GeoJSON aquí */;
        
                    // Agregar la capa GeoJson al mapa
                    folium.GeoJson(geoJsonData, {
                        style: function (feature) {
                            return {
                                fillColor: 'red',
                                fillOpacity: 0.5,
                                color: 'cyan',
                                weight: 0.5
                            };
                        }
                    }).addTo(map);
        
                    // Agregar plugins
                    folium.plugins.Geocoder().addTo(map);
                    folium.plugins.LocateControl({ autoStart: false }).addTo(map);
        
                    // Agregar Popup de coordenadas
                    var latLngPopup = folium.ClickForLatLng({ format_str: '"[" + lat + "," + lng +"]"', alert: false });
                    map.add_child(latLngPopup);
                })
                .catch(error => console.error(error));
        }
        
    </script>
</body>
</html>

</body>
</html>
